
define(["core/ajax","core/notification"],function(e,t){const a=e=>`.aulasaovivo__panel[data-panel="${e}"]`,n='[data-region="cards"]',o='[data-region="agenda"]',s='[data-action="refresh"]',i='[data-region="carousel"]',r='[data-region="feedback"]',l='[data-region="fallback-notice"]',c=new Map;let d=null,u={root:null,config:null,fallback:!1,formatters:{}};setInterval(()=>{c.forEach(M)},1e3);const m=e=>{const t=(e=>{if(!e)return"pt-BR";const t=e.replace(/_/g,"-").split("-").filter(Boolean);if(0===t.length)return"pt-BR";const[a,n,...o]=t,s=[a.toLowerCase()];return n&&s.push(n.toUpperCase()),o.length&&s.push(...o),s.join("-")})(e.locale),a=e.timezone&&"99"!==e.timezone?e.timezone:void 0;return{date:new Intl.DateTimeFormat(t,{day:"2-digit",month:"2-digit",year:"numeric",timeZone:a}),shortDate:new Intl.DateTimeFormat(t,{day:"2-digit",month:"2-digit",timeZone:a}),time:new Intl.DateTimeFormat(t,{hour:"2-digit",minute:"2-digit",timeZone:a})}},f=()=>{u.root.querySelectorAll(i).forEach(e=>{const t=e.querySelector(n);if(!t)return;const a=e.querySelector(".aulasaovivo__nav--prev"),o=e.querySelector(".aulasaovivo__nav--next"),s=()=>{const e=Math.max(0,t.scrollWidth-t.clientWidth),n=e>4,l=Math.max(0,Math.min(t.scrollLeft,e));a&&(a.hidden=!n||l<=4),o&&(o.hidden=!n||l>=e-4)},i=e=>{const a=(e=>{if(!e)return 0;const t=e.querySelector(".aulasaovivo__card");if(!t)return e.clientWidth;const a=window.getComputedStyle(e),n=parseFloat(a.columnGap||a.gap||"0")||0;return t.getBoundingClientRect().width+n})(t);if(!a)return;const n=Math.max(0,t.scrollWidth-t.clientWidth);if(n<=0)return;const o=Math.round(t.scrollLeft/a),s=Math.ceil(n/a),i=Math.max(0,Math.min(o+e,s))*a;t.scrollTo({left:i,behavior:"smooth"})};a&&a.addEventListener("click",()=>i(-1)),o&&o.addEventListener("click",()=>i(1)),t.addEventListener("scroll",()=>window.requestAnimationFrame(s)),window.addEventListener("resize",()=>window.requestAnimationFrame(s)),e._aulasaovivoUpdateNav=s,e._aulasaovivoScrollToStart=()=>{t.scrollTo({left:0,behavior:"auto"}),s()},s()})},g=e=>{if(!e)return;const t=e.closest(i);t&&("function"==typeof t._aulasaovivoScrollToStart?t._aulasaovivoScrollToStart():"function"==typeof t._aulasaovivoUpdateNav&&t._aulasaovivoUpdateNav())},v=()=>{u.root.querySelectorAll(s).forEach(e=>{e.addEventListener("click",()=>{const a=e.dataset.target;e.disabled=!0,p(a).catch(t.exception).finally(()=>{window.setTimeout(()=>{e.disabled=!1},400)})})})},p=e=>{const a=e?[e]:["catalog","enrolled"];e||(u.fallback=!1),a.forEach(e=>h(e,!0));const n=a.map(e=>_(e));return Promise.allSettled(n).then(e=>{e.forEach(e=>{"rejected"===e.status&&t.exception(e.reason)})}).finally(()=>{a.forEach(e=>h(e,!1)),j()})},h=(e,t)=>{const a=y(e);a&&(t?a.setAttribute("data-loading","true"):a.removeAttribute("data-loading"))},_=t=>{const a="catalog"===t?u.config.services.catalog:u.config.services.enrolled,[n]=e.call([{methodname:a,args:{}}]);return n.then(e=>{e.usingfallback&&(u.fallback=!0);const a=b(e.sessions);return E(t,a),e}).catch(e=>{throw E(t,[]),e})},b=e=>Array.isArray(e)?e:e&&"object"==typeof e?Object.values(e):[],y=e=>u.root.querySelector(a(e)),E=(e,t)=>{const a=y(e);if(!a)return;const s=a.querySelector(n),i=a.querySelector(o);if(!s||!i)return;w(e),s.innerHTML="",i.innerHTML="",s.scrollLeft=0;const r=t.slice().sort((e,t)=>(e.starttime||0)-(t.starttime||0));if(!r.length){const t=document.createElement("div");return t.className="aulasaovivo__empty",t.textContent="catalog"===e?u.config.strings.emptycatalog:u.config.strings.emptyenrolled,s.appendChild(t),void g(s)}r.forEach(t=>{const a=C(t,e);s.appendChild(a.element);const n=N(t);a.agendaItem=n,i.appendChild(n),x(a)}),g(s)},w=e=>{Array.from(c.entries()).forEach(([t,a])=>{a.panel===e&&c.delete(t)})},C=(e,t)=>{const a=document.createElement("article");a.className="aulasaovivo__card",a.dataset.panel=t,a.dataset.sessionId=e.id;const n=document.createElement("div");if(n.className="aulasaovivo__card-image",e.imageurl){const t=document.createElement("img");t.src=e.imageurl,t.alt=e.name||"",n.appendChild(t)}const o=document.createElement("div");o.className="aulasaovivo__card-overlay",n.appendChild(o);const s=document.createElement("div");s.className="aulasaovivo__card-countdown",n.appendChild(s);const i=document.createElement("div");i.className="aulasaovivo__card-info";const r=document.createElement("h3");r.className="aulasaovivo__card-title",r.textContent=e.name,i.appendChild(r);const l=document.createElement("div");if(l.className="aulasaovivo__card-meta",S(l,u.config.strings.startslabel,$(e)),S(l,u.config.strings.locationlabel,e.location),S(l,u.config.strings.instructorlabel,e.instructor&&e.instructor.name),i.appendChild(l),Array.isArray(e.tags)&&e.tags.length){const t=document.createElement("div");t.className="aulasaovivo__card-meta",e.tags.forEach(e=>{const a=document.createElement("span");a.className="aulasaovivo__chip",a.textContent=e,t.appendChild(a)}),i.appendChild(t)}if(e.summary){const t=document.createElement("div");t.className="aulasaovivo__card-description",t.innerHTML=e.summary,i.appendChild(t)}const c=document.createElement("div");if(c.className="aulasaovivo__card-footer",e.isenrolled&&"catalog"===t){const e=document.createElement("span");e.className="aulasaovivo__badge",e.textContent=u.config.strings.enrolledbadge,c.appendChild(e)}if("enrolled"===t){const e=document.createElement("span");e.className="aulasaovivo__badge",e.textContent=u.config.strings.confirmedbadge,c.appendChild(e)}const d=document.createElement("button");d.type="button",d.className="aulasaovivo__button",c.appendChild(d),i.appendChild(c),a.appendChild(n),a.appendChild(i);const m={session:e,panel:t,element:a,button:d,countdown:s,agendaItem:null,state:"upcoming"};return d.addEventListener("click",()=>I(m)),m},S=(e,t,a)=>{if(!a)return;const n=document.createElement("span");n.className="aulasaovivo__card-meta-item",n.textContent=`${t}: ${a}`,e.appendChild(n)},N=e=>{const t=document.createElement("div");t.className="aulasaovivo__agenda-item";const a=document.createElement("div");a.className="aulasaovivo__agenda-time",a.textContent=k(e);const n=document.createElement("div");n.className="aulasaovivo__agenda-name",n.textContent=e.name;const o=document.createElement("div");return o.className="aulasaovivo__agenda-status",t.appendChild(a),t.appendChild(n),t.appendChild(o),t},x=e=>{M(e),c.set(e.element,e)},M=e=>{const t=Date.now(),a=1e3*(e.session.starttime||0),n=1e3*(e.session.duration||0),o=a&&n?a+n:a+36e5,s=e.session.endtime?1e3*e.session.endtime:o;let i=u.config.strings.agendaunconfirmed,r="past";if(!a||t<a){r="upcoming",i=u.config.strings.agendaunconfirmed;const n=(a||t)-t;e.countdown.innerHTML=`<span class="aulasaovivo__card-countdown-label">${u.config.strings.countdownlabel}</span>${L(n)}`}else if(t>=a&&t<=s){r="live",i=u.config.strings.agendalive;const a=Math.max(0,s-t);e.countdown.innerHTML=`<span class="aulasaovivo__card-countdown-label">${u.config.strings.countdownlive}</span>${L(a)}`}else r="past",i=u.config.strings.agendapast,e.countdown.innerHTML=`<span class="aulasaovivo__card-countdown-label">${u.config.strings.countdownfinished}</span>${T(a)}`;if(e.state=r,e.element.dataset.state=r,e.agendaItem){e.agendaItem.dataset.state=r;const t=e.agendaItem.querySelector(".aulasaovivo__agenda-status");t&&(t.textContent=i)}q(e)},L=e=>{let t=Math.max(0,Math.floor(e/1e3));const a=Math.floor(t/86400);t-=86400*a;const n=Math.floor(t/3600);t-=3600*n;const o=Math.floor(t/60),s=[];return a&&s.push(`${a}d`),(n||a)&&s.push(`${n.toString().padStart(2,"0")}h`),s.push(`${o.toString().padStart(2,"0")}m`),s.join(" ")},T=e=>{if(!e)return"";const t=new Date(e);return u.formatters.shortDate.format(t)},$=e=>{if(!e.starttime)return"";const t=new Date(1e3*e.starttime);return`${u.formatters.date.format(t)} • ${u.formatters.time.format(t)}`},k=e=>{if(!e.starttime)return"";const t=new Date(1e3*e.starttime);return`${u.formatters.shortDate.format(t)} • ${u.formatters.time.format(t)}`},q=e=>{if(!e.button)return;const t=e.session,a=e.state,n=u.config.strings;if("catalog"!==e.panel)if("live"===a){const a=Boolean(t.launchurl);A(e,n.accesssession,a?"success":"secondary",!a)}else A(e,"upcoming"===a?n.accesssession:n.seemore,"secondary",!0);else{if(!t.isenrolled)return void("past"===a?A(e,n.sessionclosed,"secondary",!0):A(e,n.enrolsession,"primary",!1));if("live"===a){const a=Boolean(t.launchurl);A(e,n.accesssession,a?"success":"secondary",!a)}else A(e,"past"===a?n.sessionclosed:n.enrolledbadge,"secondary",!0)}},A=(e,t,a,n)=>{e.button.textContent=t,e.button.dataset.variant=a,e.button.disabled=n,e.button.setAttribute("aria-disabled",n?"true":"false")},I=e=>{if(e.button&&!e.button.disabled)if("catalog"===e.panel){if(!e.session.isenrolled&&"past"!==e.state)return void B(e);e.session.isenrolled&&e.session.launchurl&&"live"===e.state&&D(e.session.launchurl)}else"enrolled"===e.panel&&e.session.launchurl&&"live"===e.state&&D(e.session.launchurl)},D=e=>{window.open(e,"_blank","noopener")},B=a=>{const[n]=e.call([{methodname:u.config.services.enrol,args:{sessionid:a.session.id}}]);A(a,u.config.strings.processing,"secondary",!0),n.then(e=>{if(e.usingfallback&&(u.fallback=!0),e.status)return F(u.config.strings.enrolsuccess),a.session.isenrolled=!0,p();const t=e.message||u.config.strings.enrolfailure;F(t),a.session.isenrolled=!1,p("catalog")}).catch(e=>{t.exception(e),F(u.config.strings.enrolfailure),p("catalog")})},j=()=>{const e=u.root.querySelector(l);e&&(u.fallback?e.hidden=!1:e.hidden=!0)},F=e=>{const t=u.root.querySelector(r);t&&(t.textContent=e||u.config.strings.toastdefault,t.dataset.visible="true",clearTimeout(d),d=window.setTimeout(()=>{t.dataset.visible="false"},4e3))};return{init:e=>{if(!e)return;const a=document.getElementById(e);if(!a)return;const n=(e=>{const a=e.dataset.config;if(!a)return null;try{return JSON.parse(a)}catch(e){return t.exception(e),null}})(a);n&&(u={root:a,config:n,fallback:!1,formatters:m(n)},f(),v(),p())}}});

